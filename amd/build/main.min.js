define(["core/log","core/ajax","core/notification","core/templates","core/str"],function(a,b,c,d,e){return{init:function(){function f(a){var b=JSON.parse(a.dataset.indicator);o.innerHTML="",b.forEach(function(b){p.innerHTML=a.innerHTML;var c=l.querySelectorAll("li.activity."+b);c.forEach(function(a){o.appendChild(a.cloneNode(!0))})}),n.click()}function g(a){for(;!a.classList.contains("ind_item");)a=a.parentNode;b.call([{methodname:"format_mytopcoll_delete_indicator",args:{indicatorid:Number(a.dataset.id)},done:function(b){if(b){var d=document.querySelector(".ind_item[data-id='"+a.dataset.id+"']");d.remove()}else c.exception()},fail:c.exception}])}function h(a){for(;!a.classList.contains("ind_item");)a=a.parentNode;b.call([{methodname:"format_mytopcoll_get_edit_indicator",args:{courseid:Number(m.dataset.courseid),indicatorid:Number(a.dataset.id)},done:function(a){var b="format_mytopcoll/modchooser",e=JSON.parse(a),f=o;d.render(b,e).done(function(a,b){d.replaceNodeContents(f,a,b),k.done(function(a){p.innerHTML=a[0]}),n.click()}).fail(c.exception)},fail:c.exception}])}function i(){var a=l.querySelector("#indchooserform"),d=[],e=a.dataset.indicatorid,f=Array.from(a.querySelectorAll("input[type=checkbox]:checked"));f.forEach(function(a){d.push(a.dataset.type)}),b.call([{methodname:"format_mytopcoll_set_edit_indicator",args:{indicatorid:Number(e),data:JSON.stringify(d)},done:function(a){if(a){var b=m.querySelector('div[data-id="'+e+'"]');b.dataset.indicator=JSON.stringify(d)}else c.exception()},fail:c.exception}])}a.debug("Indicator AMD load src/main");var j={indicator:".indicator_wrap",initBtn:"#initBtnIndicator",modalContent:"#modalContentIndicator",courseContent:".course-content",modalTitle:".modal-title"},k=e.get_strings([{key:"modchoose",component:"format_mytopcoll"}]),l=document.querySelector(j.courseContent),m=l.querySelector(j.indicator),n=l.querySelector(j.initBtn),o=l.querySelector(j.modalContent),p=l.querySelector(j.modalTitle);m.addEventListener("click",function(a){for(var b=a.target;!b.contains(m);){if("indicator"===b.dataset.handler)return void f(b);if("requestremoveindicator"===b.dataset.handler)return void g(b);if("geteditindicator"===b.dataset.handler)return void h(b);if("seteditindicator"===b.dataset.handler)return void i();b=b.parentNode}})}}});